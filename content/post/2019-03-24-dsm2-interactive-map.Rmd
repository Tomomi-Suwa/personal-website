---
title: "DSM2 interactive map"
author: "Travis Hinkelman"
draft: false
date: '2019-03-24'
editor_options:
  chunk_output_type: console
slug: dsm2-interactive-map
categories:
  - R
  - Shiny
tags:
  - DSM2
  - leaflet
---
```{r include=FALSE}
# this is just a convenience for future reference to nuke these up front vs
# add to individual chunk options
knitr::opts_chunk$set(message=FALSE, warning=FALSE)
```
The [Delta Simulation Model II (DSM2)](http://baydeltaoffice.water.ca.gov/modeling/deltamodeling/models/dsm2/dsm2.cfm) is a hydrodynamic model used for [Sacramento-San Joaquin Delta](https://sacdeltaguide.atavist.com/) planning and management. When working with DSM2 output, I frequently need to look up the location of channels and nodes in the model. A map of all of the channels and nodes (and more) is provided with DSM2 as a [PDF file](/pdf/DSM2_Grid2.0.pdf), but that file is not easy to search.

Fortunately, I have access to [shapefiles](https://github.com/fishsciences/dsm2-map/tree/master/shapefiles) of DSM2 channels and nodes.^[The original source of those shapefiles is unknown to me.] With the power of [Shiny](https://shiny.rstudio.com/) and the [leaflet package](https://rstudio.github.io/leaflet/), it is relatively simple to build a web-based, interactive map of DSM2 channels and nodes (embedded below).^[Shiny app is hosted on [https://fishsciences.shinyapps.io/dsm2-map/](https://fishsciences.shinyapps.io/dsm2-map/) and code is available through [GitHub](https://github.com/fishsciences/dsm2-map).]

The app^[The code in the DSM2 map app is derived from this [example](https://www.r-bloggers.com/r-shiny-leaflet-using-observers/).] allows for panning, zooming, and clicking on the map to identify channel and node numbers. If you already know the channel or node number, then you can select the channel or node via dropdown menus with search boxes. Because most of the Delta is tidal, the app also indicates which node represents the upstream end of the channel (i.e., a positive value of flow in DSM2 output indicates that flow is moving through a channel from the upstream to the downstream end).

The main feature that is missing from this simple app is a point layer with DSM2 stations (e.g., RSAC155, RSAN112), which are common reference points for DSM2 output. 

<iframe width="725" height="800" scrolling="no" frameborder="no" src="https://fishsciences.shinyapps.io/dsm2-map/"> </iframe>
